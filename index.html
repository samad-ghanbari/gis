<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Vector Tile Map</title>
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <!-- <script src="/maplibre.js"></script> -->
    <link
      href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <!-- <link href="/maplibre.css" rel="stylesheet" /> -->
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #map {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const map = new maplibregl.Map({
        container: "map",
        style: {
          version: 8,
          glyphs: "http://localhost:3000/fonts/{fontstack}/{range}.pbf",
          sources: {
            vector_tiles: {
              type: "vector",
              tiles: ["http://localhost:3000/tiles/{z}/{x}/{y}.pbf"],
              minzoom: 0,
              maxzoom: 14,
            },
          },
          layers: [
            // Background
            {
              id: "background",
              type: "background",
              paint: { "background-color": "#e0e0d6" },
            },

            // Water (fill)
            {
              id: "water",
              type: "fill",
              source: "vector_tiles",
              "source-layer": "osm_water",

              paint: {
                "fill-color": "#a0c8f0",
                "fill-opacity": 0.6,
              },
            },

            // Landuse (like parks, forests, residential areas)
            {
              id: "landuse",
              type: "fill",
              source: "vector_tiles",
              "source-layer": "osm_landuse",
              paint: {
                "fill-color": [
                  "match",
                  ["get", "landuse"],
                  "park",
                  "#c7e9c0",
                  "forest",
                  "#a8d5a2",
                  "residential",
                  "#e0e0d6",
                  "industrial",
                  "#d0ccc0",
                  /* other */ "#f0f0f0",
                ],
                "fill-opacity": 0.6,
              },
            },

            // Parks (if separate)
            {
              id: "parks",
              type: "fill",
              source: "vector_tiles",
              "source-layer": "osm_parks",
              paint: {
                "fill-color": "#a0d48e",
                "fill-opacity": 0.6,
              },
            },

            // Buildings (fill)
            {
              id: "buildings",
              type: "fill",
              source: "vector_tiles",
              "source-layer": "osm_buildings",
              paint: {
                "fill-color": "#bbb",
                "fill-opacity": 0.7,
              },
            },

            // Railways (dashed lines)
            {
              id: "railways",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_railways",
              paint: {
                "line-color": "#999",
                "line-width": 1.5,
                "line-dasharray": [2, 4],
              },
            },

            // Roads, style by highway type
            {
              id: "motorways",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_lines",
              filter: ["==", "highway", "motorway"],
              paint: {
                "line-color": "#d35400",
                "line-width": [
                  "interpolate",
                  ["linear"],
                  ["zoom"],
                  5,
                  1,
                  14,
                  5,
                ],
              },
            },
            {
              id: "primary_roads",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_lines",
              filter: ["==", "highway", "primary"],
              paint: {
                "line-color": "#f39c12",
                "line-width": [
                  "interpolate",
                  ["linear"],
                  ["zoom"],
                  5,
                  0.7,
                  14,
                  4,
                ],
              },
            },
            {
              id: "secondary_roads",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_lines",
              filter: ["==", "highway", "secondary"],
              paint: {
                "line-color": "#f1c40f",
                "line-width": [
                  "interpolate",
                  ["linear"],
                  ["zoom"],
                  7,
                  0.5,
                  14,
                  3,
                ],
              },
            },
            {
              id: "residential_roads",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_lines",
              filter: ["==", "highway", "residential"],
              paint: {
                "line-color": "#ecf0f1",
                "line-width": [
                  "interpolate",
                  ["linear"],
                  ["zoom"],
                  10,
                  0.5,
                  14,
                  2,
                ],
              },
            },

            // Boundaries
            {
              id: "boundaries",
              type: "line",
              source: "vector_tiles",
              "source-layer": "osm_boundaries",
              paint: {
                "line-color": "#666",
                "line-width": 1,
                "line-dasharray": [2, 2],
              },
            },

            // Places (cities, towns) labels
            {
              id: "place-labels",
              type: "symbol",
              source: "vector_tiles",
              "source-layer": "osm_places",
              layout: {
                "text-field": [
                  "concat",
                  "\u200F", // RLM character
                  ["get", "name"],
                ],
                "text-font": ["B Yekan Regular"],
                "text-anchor": "right",
                "text-justify": "right",
                "text-size": [
                  "interpolate",
                  ["linear"],
                  ["zoom"],
                  5,
                  10,
                  14,
                  16,
                ],
                //"text-allow-overlap": true,
                //"text-ignore-placement": true,
              },
              paint: {
                "text-color": "#800",
                "text-halo-color": "#fff",
                "text-halo-width": 1,
              },
            },

            // // POIs labels/icons
            // {
            //   id: "poi-labels",
            //   type: "symbol",
            //   source: "vector_tiles",
            //   "source-layer": "osm_pois",
            //   layout: {
            //     "icon-image": ["get", "icon"], // you need to add icon images to your sprite
            //     "text-field": ["get", "name"],
            //     "text-font": ["Open Sans Regular"],
            //     "text-offset": [0, 0.6],
            //     "text-anchor": "top",
            //     "text-size": 12,
            //     "text-allow-overlap": true,
            //     //"text-ignore-placement": true,
            //   },
            //   paint: {
            //     "text-color": "#444",
            //     "text-halo-color": "#fff",
            //     "text-halo-width": 1,
            //   },
            // },
          ],
        },

        center: [51.41, 35.7], // Tehran
        zoom: 12,
      });

      // map.on("style.load", () => {
      //   map.addLayer({
      //     id: "road-labels",
      //     type: "symbol",
      //     source: "vector_tiles",
      //     "source-layer": "osm_lines",
      //     minzoom: 10,
      //     maxzoom: 14,
      //     layout: {
      //       "text-field": ["get", "name"],
      //       "text-font": ["Open Sans Regular"],
      //       "text-size": 12,
      //       "symbol-placement": "line",
      //       "text-allow-overlap": true,
      //       //"text-ignore-placement": true,
      //     },
      //     paint: {
      //       "text-color": "#000",
      //       "text-halo-color": "#fff",
      //       "text-halo-width": 1,
      //     },
      //   });
      // });
    </script>
  </body>
</html>
